# HTTP 메시지

## 메시지의 흐름

메시지가 흐르는 방향의 종류는 `인바운드`, `아웃바운드`, `업스트림`, `다운스트림`이 있다.

### 1. 메시지는 원 서버 방향을 인바운드로 하여 송신된다.

`인바운드`와 `아웃바운드`는 HTTP 트랜잭션 방향을 표현하기 위해 사용한다.  
메시지가 **클라이언트 -> 서버** 방향으로 이동하는 것은 `인바운드`로 이동하는 것이고, 서버에서 요청에 대한 처리가 끝난 후 **서버 -> 클라이언트**로 메시지가 이동하는 것은 `아웃바운드`로 이동하는 것이다.

### 2. 다운스트림으로 흐르는 메시지

메시지는 수직적으로 흐른다. 요청 메시지냐 응답 메시지냐에 관계없이, **모든 메시지는 다운스트림으로 흐른다.**  
클라이언트 요청 시, 프락시1 -> 프락시2 -> 프락시3 으로 메시지가 흐른다면 요청에선 **프락시1이 프락시3의 업스트림**이지만 응답 시에는 **프락시3이 프락시1의 업스트림**이다.

<br />

## 메시지의 각 부분

HTTP 메시지는 일반 텍스트 형식인 `시작줄`과 `헤더`, 데이터를 담는 `본문`으로 이루어진다.

<img width="720" alt="image" src="https://github.com/flataex/http-the-definitive-guide-study/assets/67260437/d4d922ed-29f2-4649-ab38-556082327434">  
시작줄은 어떤 메시지인지, 헤더는 속성을 나타낸다.

### 1. 시작줄

- 메서드

  | 메소드  | 설명                                                                                          |
  | ------- | --------------------------------------------------------------------------------------------- |
  | GET     | 서버에서 클라이언트로 특정 리소스 전송 요청                                                   |
  | HEAD    | 지정한 리소스에 대한 응답에서 HTTP 헤더만 요청 => 리소스의 정보나 변경 유무를 확인할 수 있다. |
  | POST    | 서버가 처리해야 할 데이터 **전송**                                                            |
  | PUT     | 서버에 요청 메시지 본문을 **저장**                                                            |
  | TRACE   | 메시지가 프락시를 거쳐 서버에 도달하는 과정 추적                                              |
  | OPTIONS | 서버가 어떤 메서드를 수행할 수 있는지 확인                                                    |
  | DELETE  | 지정한 리소스를 서버에서 삭제 요청 (실제로 삭제되었는지 보장하지 않는다.)                     |

  HTTP 명세를 확장한 `확장 메서드`를 추가로 구현해 사용할 수도 있다.

- 상태코드  
   전체 범위 | 정의된 범위 | 분류
  --|--|--
  100-199 | 100-101 | 정보
  200-299 | 200-206 | 성공
  300-399 | 300-305 | 리다이렉션
  400-499 | 400-415 | 클라이언트 에러
  500-599 | 500-505 | 서버 에러

  상태코드 역시 확장하여 추가될 수 있다.

- 버전 번호
  HTTP/1.0 애플리케이션이 HTTP/1.1 메시지를 받았을 때, 애플리케이션은 HTTP/1.0까지 이해할 수 있다. 버전 번호는 각 자리수 별로 비교한다. 2.22버전은 2.3 버전보다 크다.

### 2. 헤더

HTTP 헤더 필드는 이름/값 쌍의 목록이고, `일반 헤더`, `요청 헤더`, `응답 헤더`, `엔터티 헤더`, `확장 헤더`로 분류된다.  
엔터티 헤더는 본문 크기와 콘텐츠 또는 리소스 자체를 서술한다.

<br />

## 메서드

### 1. 안전한 메서드

`GET`과 `HEAD`는 요청의 결과로 서버에 어떤 작용도 없기 때문에 안전한 메서드에 속한다. 개발 방법에 따라 안전한 메서드를 사용해 서버에 작용을 유발할 수도 있지만, 안전한 메서드 자체의 목적은 서버에 어떤 작용을 일으키는 메서드(안전하지 않은 메서드)가 사용될 때 사용자에게 그 사실을 알려주는 애플리케이션을 만드는 것이다.

<br />

## 상태코드

### 1. 정보성 상태코드

- 클라이언트의 100 continue  
   클라이언트가 요청 본문을 보내기 전에, 서버가 받을 수 있는 상태인지 확인하기 위한 의도로 도입되었다. 요청에 엔터티가 없다면 클라이언트는 `Expect: 100-continue`값을 보내지 말아야한다. 이 값을 받은 서버는 엔터티를 보낼 것으로 예상하기 때문이다. 또한 서버에서 응답이 오기까지 막연히 기다리지 않고, 약간의 타임아웃 후에 엔터티를 보내야한다.
- 서버의 100 continue  
   클라이언트에서 `Expect: 100-continue` 값을 받는다면, 서버는 에러코드 혹은 100 continue 응답을 보내야한다. 만약 응답을 보내기 전에 엔터티를 받는 경우 응답하지 않고 요청을 처리한 다음 요청에 대한 결과를 응답해야한다.
- 프락시 서버의 100 continue  
   서버와 클라이언트의 HTTP 버전에 따라 헤더를 조정한다.

### 2. 성공 상태코드

| 상태코드 | 사유 구절                     | 의미                                                                           |
| -------- | ----------------------------- | ------------------------------------------------------------------------------ |
| 200      | OK                            | 엔터티 본문이 요청된 리소스를 갖고 있다.                                       |
| 201      | Created                       | 서버에 개체를 생성했다. ex) put                                                |
| 202      | Accepted                      | 요청은 받았으나 결과는 보장되지 않는 상태                                      |
| 203      | Non-Authoritative Information | 프락시에서 리소스의 사본이 리턴된 상태                                         |
| 204      | No Content                    | 서버에서 정상적인 변경 또는 삭제 처리가 이루어진 상태이며 response가 없는 상태 |
| 205      | Reset Content                 | 현재 페이지에 있는 HTML 폼에 채워진 모든 값을 비우라고 말한다.                 |
| 206      | Partial Content               | 부분 혹은 범위 요청이 성공한 상태                                              |

### 3. 리다이렉션 상태코드

만약 리소스가 옮겨졌다면, 클라이언트에게 리소스가 옮겨졌으며 어디서 찾을 수 있는지 알려주기 위해 리다이렉션 상태 코드와 Location 헤더를 보낼 수 있다. 이는 브라우저가 사용자를 귀찮게 하지 않고 알아서 새 위치로 이동할 수 있게 해준다. 또는 로컬 복사본이 원래 서버와 비교했을 때 여전히 최신인지 확인할 수 있다.  
상태코드 | 사유 구절 | 의미
--|--|--
300 | Multiple Choices | 클라이언트가 동시에 여러 리소스를 가리키는 URL을 요청한 경우, 그 리소스의 목록과 함께 반환한다.
301 | Moved Permanently | 요청한 URL이 옮겨졌을 때 사용한다. 응답은 Location 헤더에 현재 리소스가 존재하고 있는 URL을 포함해야 한다. 브라우저는 이 페이지로 리다이렉트한다.
302 | Found | Location 헤더로 주어진 URL이 임시적일 때 사용한다.
303 | See Other | PUT, POST의 결과로 전송되는 경우가 많다. 리다이렉션이 요청한 리소스 자체에 연결되지 않고 다른 페이지(확인페이지, 진행 페이지 등)으로 연결될 때 사용된다.
304 | Not Modified | 클라이언트가 조건부 조회 요청을 했고, 그 리소스가 최근에 수정된 일이 없다면 재전송할 필요가 없음을 나타낸다. 캐시된 자원으로의 암묵적인 리디렉션이다.
305 | Use Proxy | 리소스가 반드시 프락시를 통해서 접근되어야 함을 나타내기 위해 사용한다.
307 | Temporary Redirect | 요청한 URL이 임시로 옮겨졌을 때 사용한다. 이후에는 원래 URL을 사용한다.

**302, 303, 307**  
`302` 상태코드는 HTTP/1.0에서 클라이언트가 POST로 보낸 요청을 GET으로 리다이렉션 시키기 위해 사용되었다. HTTP/1.1 명세에서는 이 리다이렉션 처리를 `303`을 사용하도록 되었고, 요청 메소드를 변경하지 않는 일시적인 리다이렉션은 `307`을 사용하도록 되었다.

> [302 예시]  
> POST로 요청을 보낸 후 서버에서 받은 URL을 GET으로 다시 요청하여 결과 페이지로 넘어간다. 새로고침해도 중복주문되지 않고, 결과 페이지가 보여진다.

### 4. 클라이언트 에러 상태코드

| 상태코드 | 사유 구절                       | 의미                                                                                                                |
| -------- | ------------------------------- | ------------------------------------------------------------------------------------------------------------------- |
| 400      | Bad Request                     | 클라이언트가 잘못된 요청을 보냈다고 말해준다.                                                                       |
| 401      | Unauthorized                    | 클라이언트 인증이 필요한 상태이다.                                                                                  |
| 403      | Forbidden                       | 서버에 의해 요청이 거절된 상태이다.                                                                                 |
| 404      | Not Found                       | 요청한 URL을 찾을 수 없는 상태이다.                                                                                 |
| 405      | Method Not Allowed              | 요청한 URL에 대해, 지원하지 않는 메소드로 요청받았을 때 사용한다. 서버는 지원하는 메소드를 allow 헤더에 보내야한다. |
| 407      | Proxy Authentication Required   | 리소스에 대해 인증을 요구하는 프락시 서버를 위해 사용한다.                                                          |
| 408      | Request Timeout                 | 클라이언트의 요청을 완수하기에 시간이 너무 많이 걸리는 경우, 서버는 이 상태 코드로 응답하고 연결을 끊을 수 있다.    |
| 409      | Conflict                        | 요청이 충돌을 일으킬 염려가 있다고 생각될 때 이 요청을 보낼 수 있다.                                                |
| 410      | Gone                            | 리소스가 존재했다가 사라진 경우 클라이언트에게 알려주고자 사용된다.                                                 |
| 411      | Length Required                 | Content-Length 헤더가 필요할 때 사용된다.                                                                           |
| 412      | Precondition Failed             | 클라이언트가 보낸 조건부 조회 요청(Expect 헤더)에 대해 실패한 경우 사용된다.                                        |
| 413      | Request Entity Too Large        | 서버가 처리할 수 있는 크기를 초과하는 요청이 들어온 경우 사용된다.                                                  |
| 414      | Request URI Too Long            | URL의 길이가 너무 길 때 사용된다.                                                                                   |
| 415      | Unsupported Media Type          | 서버가 이해하거나 지원하지 못하는 내용 유형의 엔터티를 클라이언 트가 보냈을 때 사용한다.                            |
| 416      | Requested Range Not Satisfiable | 요청 메시지가 리소스의 특정 범위를 요청했는데, 그 범위가 잘못되었 거나 맞지 않을 때 사용한다.                       |
| 417      | Expectation Failed              | Expect 요청 헤더에 서버가 지원하지 않는 값이 있을 때 사용된다.                                                      |

### 5. 서버 에러 상태코드

| 상태코드 | 사유 구절                  | 의미                                                                                          |
| -------- | -------------------------- | --------------------------------------------------------------------------------------------- |
| 500      | Internal Server Error      | 서버가 요청을 처리할 수 없게 만드는 에러를 만났을 때 사용한다.                                |
| 501      | Not Implemented            | 서버가 요청 메소드를 이해하지 못하거나 어떤 리소스를 지원하지 않은 경우에 사용한다.           |
| 502      | Bad Gateway                | 업스트림 서버로부터 유효하지 않은 응답을 받았을 때 사용된다.                                  |
| 503      | Service Unavailable        | 서버가 요청을 처리해 줄 수 없지만 나중에는 가능함을 의미한다.                                 |
| 504      | Gateway Timeout            | 다른 서버에게 요청을 보내고 응답을 기다리다 타임아웃이 발생한 경우에 사용된다.                |
| 505      | HTTP Version Not Supported | 서버가 지원할 수 없거나 지원하지 않으려고 하는 버전의 프로토콜로된 요청을 받았을 때 사용한다. |

<br />

## 헤더

### 1. 일반 헤더

일반 헤더에는 클라이언트, 서버 모두에 유용한 정보가 담긴다.

**일반 캐시 헤더**
HTTP/1.0은 로컬 복사본으로 캐시할 수 있도록 해주는 최초의 헤더를 도입했다.  
 ex) Cache-Control

### 2. 요청 헤더

요청 메시지에서만 의미를 갖는 헤더로, 클라이언트의 정보를 갖는다.  
ex) User-Agent, Client-IP, Host(클라이언트가 요청을 보낸 서버 호스트명, 포트) 등

**Accept 관련 헤더**  
클라이언트는 서버에게 Accept 헤더를 보내 원하는 리소스를 특정할 수 있다.  
ex) Accept, Accept-Charset, Accept-Encoding 등

**조건부 요청 헤더**  
헤더에 조건부를 포함시켜, 서버에서 원하는 리소스를 받을 수 있다.  
ex) If-Modified-Since, If-Range, If-Match 등

**요청 보안 헤더**  
ex) Authorization(인증 토큰), Cookie 등

**프락시 요청 헤더**  
ex) Proxy-Authorization, Proxy-Connection 등

### 3. 응답 헤더

응답 헤더는 클라이언트에게 부가 정보를 제공한다.  
ex) Age, Pubic, Server 등

**협상 헤더**  
서버와 클라이언트가 어떤 표현을 택할 것인가에 대한 협상을 할 수 있도록 지원한다.
ex) Accept-Ranges 등

**응답 보안 헤더**  
ex) Proxy-Authenticate(프락시에서 보낸 인증 목록), Set-Cookie 등

### 4. 엔터티 헤더

클라이언트나 서버에서 보내는 엔터티에 대한 정보를 갖는다.  
ex) Allow, Location 등

**콘텐츠 헤더**  
ex) Content-Type, Content-Range, Content-Length 등

**엔터티 캐싱 헤더**  
ex) Expires, Last-Modified 등
