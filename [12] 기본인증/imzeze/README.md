# 기본 인증

## 인증

### 인증 프로토콜과 헤더

HTTP에는 `기본 인증`과 `다이제스트 인증이`라는 두 가지 공식적인 인증 프로토콜이 있다. 다음은 기본 인증에서 사용되는 헤더 목록이다.
| 단계 | 헤더 | 내용 | 메서드/상태 |
| --------- | ------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------- |
| 인증 요구 | WWW-Authenticate | 서버에서 클라이언트에 요구하는 인증 체계와 매개변수가 담겨있다. <br/> 인증 체계에는 `Basic`, `Digest`, `Bearer`가 있고, 매개변수는 인증 체계에 따라 다르다. | 401 |
| 인증 | Authorization | 인증 체계와 base64로 인코딩한 사용자 식별값을 보낸다. | GET |
| 인증 완료 | Authentication-Info | 추가적인 인증 알고리즘에 대한 정보를 제공한다. <br /> (기본인증 프로토콜에서 사용하지 않는다.) | 200 |
<br/>

## 기본인증

### 보안영역

웹 서버는 보안 영역을 `realm`으로 나눈다. realm마다 다른 사용자 권한을 요구하여 리소스마다 접근할 수 있는 사용자를 구분할 수 있다. realm 값은 `WWW-Authenticate`헤더의 매개변수로 전달된다.

> WWW-Authenticate: Basic realm="Family"

### Base64 사용자 이름/비밀번호 인코딩

HTTP 기본 인증은 사용자 이름과 비밀번호를 콜론으로 이어서 합치고, base64 인코딩 메서드를 사용해 인코딩한다.

> base64란?  
> 데이터를 텍스트로 인코딩하는 방식 중 하나이다.
>
> 1. 입력 데이터를 3바이트(24비트)씩 그룹화한다.
> 2. 그룹화된 데이터를 6비트씩 분할해 4개의 그룹을 만든다.
> 3. 각 그룹의 값을 인덱스로 사용하여 Base64 문자 테이블에서 해당 문자를 찾는다.
> 4. 문자를 연결하여 반환한다.
>
> 디코딩은 이 로직을 반대로 수행한다.

### 프락시 인증

프락시 서버에서 접근 정책을 중앙 관리할 수 있기 때문에, 회사 리소스 전체에 대해 통합적인 접근 제어를 하기 위해서 프락시 서버를 사용하면 좋다. 프락시 서버의 인증 절차는 웹서버와 동일하고 헤더와 상태코드만 다르다.

| 웹서버              | 프락시 서버                        |
| ------------------- | ---------------------------------- |
| 401                 | 407(Proxy Authentication Required) |
| WWW-Authenticate    | Proxy-Authenticate                 |
| Authorization       | Proxy-Authorization                |
| Authentication-Info | Proxy-Authentication-Info          |

## 기본 인증의 보안 결함

기본 인증은 단순하고 편리하지만, 아래와 같은 보안 결함이 있어 SSL과 혼용해서 쓰거나 악의적인 행동이 없을 것이라 판단되는 상황에서 접근 권한을 확인하는 데에만 쓰인다.

- 사용자의 식별자 값이 쉽게 디코딩될 수 있다.  
  따라서 모든 HTTP 트랜잭션을 SSL 암호화 채널을 통해 보내거나, 보안이 더 강화된 다이제스트 인증 같은 프로토콜을 사용하는 것이 좋다.
- 디코딩이 어렵게 인코딩되어 있더라도 인코딩 값을 가로채 서버에 보내면 인증을 성공할 수 있다.
- 가짜 서버가 사용자에게 인증을 요청해도 사용자는 이를 알지 못하고 비밀번호를 보낼 수 있다.
